process {
    clusterOptions = '-l h_vmem=8G'
    executor = 'sge'
    queue = 'igmm_long'

    scratch = true

    beforeScript = """
    . /etc/profile.d/modules.sh
    module load anaconda/5.0.1
    """

    withLabel: fastq {
        conda = 'fastqc fastq-screen trim-galore samtools bowtie2=2.3.5 picard multiqc bedtools'
    }

    withLabel: python {
        conda = 'python=3.6 pandas'
    }

    withLabel: bigmem {
	   clusterOptions = { task.exitStatus == 140 ? '-l h_vmem=32G' : '-l h_vmem=16G' }
    }
 
    withLabel: retry_mem {
	   clusterOptions = { task.exitStatus == 140 ? '-l h_vmem=16G' : '-l h_vmem=8G' }
    }

    withLabel: baal_chip {
        conda = '/exports/igmm/eddie/ponting-lab/oyvind/anaconda/envs/r_new'
    }

    withLabel: mpi {
        cpus = 16
        time = '2d'
        penv = "scatter"
        beforeScript = """
        . /etc/profile.d/modules.sh
        module load anaconda/5.0.1
        module load openmpi/4.0.0
        """
    }

}

env {
    BOWTIE2_INDEXES = "/exports/igmm/eddie/ponting-lab/oyvind/bowtie/indexes"
}

params {
    fastq_screen_conf = '/exports/igmm/eddie/ponting-lab/oyvind/fastq_screen/fastq_screen.conf'
    mpiflags = '--mca btl self,tcp --mca btl_tcp_if_include 192.41.104.0/23'
}

executor {
    queueSize = 200
}
